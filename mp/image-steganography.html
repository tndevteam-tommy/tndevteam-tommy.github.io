<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Steganography - Hide Text in Images</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f0f0f0;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        canvas {
            border: 2px solid #ddd;
            margin: 10px;
            max-width: 100%;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .canvas-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
        }
        .info {
            background: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Image Steganography - Hide Text in Images</h1>
        <p>This tool can hide text messages inside images using LSB (Least Significant Bit) steganography.</p>
        
        <div>
            <label>Upload an image:</label>
            <input type="file" id="imageInput" accept="image/*">
        </div>
        
        <div>
            <label>Text to hide:</label>
            <textarea id="textToHide" rows="3" placeholder="Enter secret message...">This is a hidden message!</textarea>
        </div>
        
        <button onclick="hideText()">Hide Text in Image</button>
        <button onclick="extractText()">Extract Hidden Text</button>
        
        <div class="info">
            <strong>How it works:</strong> The least significant bit of each pixel's color channels is modified to store text data. 
            This creates minimal visual changes to the image while allowing text to be hidden and extracted.
        </div>
        
        <div class="canvas-container">
            <div>
                <h3>Original Image</h3>
                <canvas id="originalCanvas" width="300" height="200"></canvas>
            </div>
            <div>
                <h3>Image with Hidden Text</h3>
                <canvas id="hiddenCanvas" width="300" height="200"></canvas>
            </div>
        </div>
        
        <div id="result"></div>
    </div>

    <script>
        let originalImageData = null;
        let hiddenImageData = null;
        
        document.getElementById('imageInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        displayOriginalImage(img);
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });
        
        function displayOriginalImage(img) {
            const canvas = document.getElementById('originalCanvas');
            const ctx = canvas.getContext('2d');
            
            // Calculate dimensions to fit canvas while maintaining aspect ratio
            const maxWidth = 300;
            const maxHeight = 200;
            let { width, height } = img;
            
            if (width > maxWidth || height > maxHeight) {
                const ratio = Math.min(maxWidth / width, maxHeight / height);
                width *= ratio;
                height *= ratio;
            }
            
            canvas.width = width;
            canvas.height = height;
            
            ctx.drawImage(img, 0, 0, width, height);
            originalImageData = ctx.getImageData(0, 0, width, height);
        }
        
        function hideText() {
            if (!originalImageData) {
                alert('Please upload an image first!');
                return;
            }
            
            const text = document.getElementById('textToHide').value;
            if (!text) {
                alert('Please enter text to hide!');
                return;
            }
            
            // Convert text to binary
            const textBinary = textToBinary(text);
            const textLength = textBinary.length;
            
            // Check if image can hold the text
            const maxCapacity = originalImageData.data.length * 3; // 3 color channels per pixel
            if (textLength > maxCapacity) {
                alert(`Text too long! Maximum capacity: ${Math.floor(maxCapacity / 8)} characters`);
                return;
            }
            
            // Create copy of original image data
            const hiddenData = new ImageData(
                new Uint8ClampedArray(originalImageData.data),
                originalImageData.width,
                originalImageData.height
            );
            
            // Add length header (32 bits = 4 bytes)
            const lengthBinary = textLength.toString(2).padStart(32, '0');
            const fullBinary = lengthBinary + textBinary;
            
            let bitIndex = 0;
            
            // Hide data in LSB of each color channel
            for (let i = 0; i < hiddenData.data.length && bitIndex < fullBinary.length; i += 4) {
                // Skip alpha channel (i+3)
                for (let channel = 0; channel < 3 && bitIndex < fullBinary.length; channel++) {
                    const pixelIndex = i + channel;
                    const bit = fullBinary[bitIndex];
                    
                    // Modify LSB
                    hiddenData.data[pixelIndex] = (hiddenData.data[pixelIndex] & 0xFE) | parseInt(bit);
                    bitIndex++;
                }
            }
            
            // Display image with hidden text
            const canvas = document.getElementById('hiddenCanvas');
            const ctx = canvas.getContext('2d');
            canvas.width = hiddenData.width;
            canvas.height = hiddenData.height;
            ctx.putImageData(hiddenData, 0, 0);
            
            hiddenImageData = hiddenData;
            
            // Show download option
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `
                <div class="info">
                    <strong>Success!</strong> Text hidden in image. 
                    <button onclick="downloadImage()">Download Image with Hidden Text</button>
                </div>
            `;
        }
        
        function extractText() {
            if (!hiddenImageData) {
                alert('Please hide text in an image first!');
                return;
            }
            
            let binaryData = '';
            let bitIndex = 0;
            
            // Extract data from LSB of each color channel
            for (let i = 0; i < hiddenImageData.data.length; i += 4) {
                // Skip alpha channel (i+3)
                for (let channel = 0; channel < 3; channel++) {
                    const pixelIndex = i + channel;
                    const bit = hiddenImageData.data[pixelIndex] & 1;
                    binaryData += bit.toString();
                }
            }
            
            // Extract length (first 32 bits)
            const lengthBinary = binaryData.substring(0, 32);
            const textLength = parseInt(lengthBinary, 2);
            
            // Extract text data
            const textBinary = binaryData.substring(32, 32 + textLength);
            const extractedText = binaryToText(textBinary);
            
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `
                <div class="info">
                    <strong>Extracted Text:</strong> "${extractedText}"
                </div>
            `;
        }
        
        function textToBinary(text) {
            let binary = '';
            for (let i = 0; i < text.length; i++) {
                const charCode = text.charCodeAt(i);
                binary += charCode.toString(2).padStart(8, '0');
            }
            return binary;
        }
        
        function binaryToText(binary) {
            let text = '';
            for (let i = 0; i < binary.length; i += 8) {
                const byte = binary.substring(i, i + 8);
                const charCode = parseInt(byte, 2);
                text += String.fromCharCode(charCode);
            }
            return text;
        }
        
        function downloadImage() {
            if (!hiddenImageData) return;
            
            const canvas = document.createElement('canvas');
            canvas.width = hiddenImageData.width;
            canvas.height = hiddenImageData.height;
            const ctx = canvas.getContext('2d');
            ctx.putImageData(hiddenImageData, 0, 0);
            
            canvas.toBlob(function(blob) {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'hidden_text_image.png';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
        }
    </script>
</body>
</html>
